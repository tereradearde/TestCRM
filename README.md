## Запуск

```bash
uvicorn app.main:app --reload
```

## Модель данных

* `Operator` - оператор поддержки. Поля: `name`, `active`, `load_limit`, `created_at`. Имеет связи с назначениями (`SourceOperatorAssignment`) и обращениями (`Contact`).
* `Lead` - конечный клиент. Идентифицируется по `external_id` (например, телефон или email). Содержит опциональное поле `name`.
* `Source` - источник/бот, через который приходит обращение. Имеет множества назначений операторов с весами.
* `SourceOperatorAssignment` - конфигурация распределения: вес оператора для конкретного источника.
* `Contact` - обращение лида из конкретного источника. Содержит ссылку на лида, источник, назначенного оператора, статус и произвольное сообщение.

## Алгоритм распределения

1. Лид ищется по `lead_external_id`. Если не найден, то создаётся новый. Имя лида обновляется при первом появлении.
2.  Для источника выбираются активные операторы согласно конфигурации. Рассчитывается их текущая загрузка как количество активных обращений (`Contact.status == "active"`).
3.  Оператор считается доступным, если его загрузка меньше `load_limit`. Значение 0 интерпретируется как отсутствие лимита.
4.  Из списка доступных операторов выбирается один с помощью взвешенного случайного выбора пропорционально настроенным весам.
5.  Если подходящих операторов нет, обращение сохраняется без назначенного оператора. Причина фиксируется только в логике распределения и возвращается клиенту косвенно.

## Дополнительно

- Веса задаются целыми числами `> 0`. Чем выше вес, тем больше доля обращений достанется оператору.
- Лимиты задаются целыми числами `>= 0`. Значение `0` - оператор не ограничен по количеству активных обращений.